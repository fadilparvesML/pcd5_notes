Continue after [[Clustering]]

1. Call the `manipulate_date_columns` to create the date related columns
2. Create empty dataframe to hold the processed transactions
3. Check if the transactions are not empty, if empty just return the empty dataframe created at step 2
4. Create groups where the each group corresponds to each bv account id, given all the transactions are client_id level and one client can have multiple bank_id and each bank can have multiple account id. So here it means the transactions are processed on account_id level
5. For each `bv_account_id` and its `group` run the [[Classification#**process_cluster** |process cluster]] function and append the output to the empty dataframe created at step 2. 
6. If `tagger` is in `processed_transactions` set `pcd_txn_type` as `paycheck` if `tagger` of the processed transaction row is not null else set it as `potential_paycheck`
7. Return the `processed_transactions`

# process_cluster
1. Create empty df with columns taken from then input transaction
2. If the length of transactions is more than or equal 2 then continue with the process
3. Create transaction include df that is basically all the transactions where for a given `income_id` there is more than **2** transactions. 

| client_id | txn_date | income_id | feed    |
| --------- | -------- | --------- | ------- |
| 1         | 2024     | aaa       | payroll |
| 1         | 2024     | aaa       | payroll |
| 1         | 2024     | bbb       | payroll |
| 1         | 2024     | ccc       | payroll |
| 1         | 2024     | ccc       | payroll |
| 1         | 2024     | ccc       | payroll |
The groupby will create a table like below

| income_id | count |
| --------- | ----- |
| aaa       | 2     |
| bbb       | 1     |
| ccc       | 3     |
Based on this only the `ccc` transactions will be part of the `transaction_include` df.

4. Check if the length of `transaction_include` is not empty
5. Call the [[Classification#**process_cluster_include** | process_cluster_include]] function, which is the main function for classification
6. Get the `transactions_clustered` from step 5 and append the output to `final_transaction` array
7. Create transactions exclude df that is all the transaction where for a given `income_id` there is less than or equal 2 transactions
8. If the exclude transaction df is not empty then call [[Classification#process_cluster_exclude |process_cluster_exclude]] 
9. Get the `transactions_clustered` from step 8 and append the output to `final_transaction` array
10. If step 2 was false then call function [[Classification#process_less_2_transactions]]
11. If any part of the process fail then call [[Classification#process_exception |process_exception]]
12. Finally return the transactions

# process_cluster_include

1. Create empty `tagged_transactions_list` array
2. For each unique `income_id` from the `transactions` `income_id`s 
3. Filter for transactions that belongs to the current in loop `income_id`
4. Call the [[Classification#identify_include |identify_include]] function which belongs to the `IdentifyAmountOutlier` class
5. Filter for transactions that are not outlier
6. Call the [[Classification#ProcessClientStats.get |get]] function to get the client stats
7. Call the [[Classification#ProcessClusterStats.get_include_stats | get_include_stats]] with dataframe that contains transaction from step 5
8. Call the [[Classification#ProcessClusterTimDiffStats.get | get]] with the input as `unique_cluster_id` and `clustered_transactions_wo_outlier`
9. Call the [[Classification#ProcessClusteredTagger.process_include |process_include]] with clustered transactions from last step, client stats, cluster stats and cluster time diff stats as input
10. If tagged_sub_transactions_list from step 9 is not None then append to the `tagged_transactions_list` array
11. If the length of `tagged_transactions_list` is more than 0 then concat all the df in `tagged_transactions_list` and return it

# process_cluster_exclude

1. Create empty `tagged_transactions_list` array
2. For each unique `income_id` from the `transactions` `income_id`s 
3. Filter for transactions that belongs to the current in loop `income_id`
4. Set the `is_amount_outlier` to `not_outlier` for all transactions
5. Call the [[Classification#ProcessClientStats.get |get]] function to get the client stats
6. Call the [[Classification#ProcessClusterStats.get_exclude_stats | get_exclude_stats]] with dataframe that contains transaction from step 5
7. Sort the clustered transactions by transaction date ascending
8. Call the [[Classification#ProcessClusteredTagger.process_exclude |process_exclude]] with clustered transactions from last step, client stats, cluster stats and cluster time diff stats as None as input
9. If tagged_sub_transactions_list from step 8 is not None then append to the `tagged_transactions_list` array
10. If the length of `tagged_transactions_list` is more than 0 then concat all the df in `tagged_transactions_list` and return it

# identify_include

1. Calls the [[Classification#label_amount_outlier |label_amount_outlier]] method by passing in the compressed clustered transactions
2. Return from the above method is a df, use the df and check if all the transactions are not outlier then just set `is_amount_outlier` to `not_outlier` and then return the df or else continue
3. Call the [[Classification#calculate_cluster_time_diff_stats |calculate_cluster_time_diff_stats]] function with then input being dataframe from step 1
4. Call the [[Classification#rectify_false_amount_outlier |rectify_false_amount_outlier]] method with the dataframe from step above as input
5. If all transactions are outliers (illogical), do not label them as outliers and return the clustered transactions
6. Create `amount_outlier_dates` variable that holds the dates for all the transactions that are `outliers`
7. Create mask `cond_is_amount_outlier` by taking all clustered transactions that the `transaction_date` is in the `amount_outlier_dates`
8. Update the `is_amount_outlier` for those rows that are True for `cond_is_amount_outlier` to `outlier` else it is `not_outlier`
9. Return the clustered transactions

# label_amount_outlier

1. Defines the 40th and 60th quantile of transactions amount
2. Set the tolerance to 0.5
3. Create mask `cond_low_outlier` if the amount is < quantile 40 x (1 - tolerance)
4. Create mask `cond_high_outlier` if the amount is > quantile 60 x (1 - tolerance)
5. Create `is_amount_outlier` column in the dataframe and set it to `not_outlier`
6. Update the value of the column based on the created mask, and it the mask is true then set it to `outlier`

# calculate_cluster_time_diff_stats

Calculate the time difference between consecutive transactions in a cluster  
  
Assumption:  
- The transactions are sorted by date in ascending order  
- The transactions with same transaction date are treated as one daily paycheck (deduplicated on date)

1. Create column called `time_diff` and set the value as days difference between the following rows
2. If the `drop_na` is True then drop na rows for `time_diff` or else just return the df 

# rectify_false_amount_outlier

Rectify false amount outlier if cumulative day difference is within 0.2*multiplier*median  
and 0.5*multiplier*median

1. Filter for transactions that are not outlier
2. Skip if all transactions are outliers (and thus, none of the day difference is accurate) or all not outlier transactions have null day difference (this happens when first transaction is not an outlier but the rest are outlier).
3. Else get the median by taking the `time_diff` 50th quantile
4. Set tolerance to 0.2
5. Set `lower_bound` and `upper_bound`
6. Compute cumulative day difference. Reset cumulative day difference if there is a  value change in is_amount_outlier column, in order to prevent cumulative day  difference from accumulating.
7. Rectify false amount outlier by comparing cumulative day difference with lower and upper bound of day difference
8. Rectify false amount outlier for the first/earliest transaction, As first transaction does not have day difference, have to use day difference of second transaction to rectify false amount outlier, If day difference of second transaction is within lower and upper bound, then label first transaction as not_outlier.

# ProcessClientStats.get

1. Create instance of ClientStats class and add the attributes info from the dataframe
2. Return the client stats

# ProcessClusterStats.get_include_stats

1. This function keeps info on different date stats

# ProcessClusterTimDiffStats.get

Compute the day differences, storing them in 'diff'  
If two consecutive transactions in a cluster has the same date, then  
we treat them as the same daily paycheck  
Simple example:  
Time diff:  
Transaction 1: 12 Sept      NaN (undefined for first transaction)  
Transaction 2: 12 Sept      treat as one daily paycheck with transaction 1  
Transaction 3: 19 Sept      7 days  
Transaction 4: 19 Sept      treat as one daily paycheck with transaction 3

# ProcessClusteredTagger.process_include

1. Check for anti payroll keyword [[Classification#is_anti_payroll_keywords_found |is_anti_payroll_keywords_found]] 
2. If no anti payroll keywords found then get the payroll keywords by calling [[Classification#get_payroll_keywords_found |get_payroll_keywords_found]] function
3. If account type is roarmoney then trigger [[Classification#process_roar_money_account |process_roar_money_account]] 
4. Else trigger [[Classification#process_none_roar_money_account |process_none_roar_money_account]] 
5. If got anti payroll keywords (refer step 2) then get the bool to indicate if salary keywords found
6. Then trigger [[Classification#process_anti_payroll_keywords_present |process_anti_payroll_keywords_present]] 
7. Finally return the clustered transactions

# is_anti_payroll_keywords_found

1. Input is word_list
2. Call the [[Classification#get_most_frequent_feed |get_most_frequent_feed]] method with the word_list as input
3. Call the is_keyword_present_in_feed function that basically returns True or False if any of the keywords in keyword list (SALARY/ PAYROLL/ ANTI-PAYROLL KEYWORDS) is contained within the feed (string cleaned description) that is being compared against.

# get_most_frequent_feed

1. If the word_list is not empty then get the mode of the word_list which basically means take the value that has the most occurrence 
2. Return the word or None if word_list is empty

# get_payroll_keywords_found

For each feed in word_list check if it contains keyword that is in PAYROLL_KEYWORD list, and if yes then return it as element of list

# process_roar_money_account

| Tagger         | Pattern                                                     | Condition                                                                                                                                                                                                                                                                                                            |
| -------------- | ----------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| weekly         | None                                                        | `mean > 6 and mean < 8 and std < 1`                                                                                                                                                                                                                                                                                  |
| monthly        | None initially; conditions below determine specific pattern | `mean > 27 and mean < 32`                                                                                                                                                                                                                                                                                            |
|                | monthly_M5                                                  | `prop_second_wed >= M_THRESHOLD`                                                                                                                                                                                                                                                                                     |
|                | monthly_M5_adjusted                                         | `prop_adjusted_second_wed >= M_THRESHOLD`                                                                                                                                                                                                                                                                            |
|                | monthly_M6                                                  | `prop_third_wed >= M_THRESHOLD`                                                                                                                                                                                                                                                                                      |
|                | monthly_M6_adjusted                                         | `prop_adjusted_third_wed >= M_THRESHOLD`                                                                                                                                                                                                                                                                             |
|                | monthly_M7                                                  | `prop_fourth_wed >= M_THRESHOLD`                                                                                                                                                                                                                                                                                     |
|                | monthly_M7_adjusted                                         | `prop_adjusted_fourth_wed >= M_THRESHOLD`                                                                                                                                                                                                                                                                            |
|                | monthly_M8                                                  | `prop_third_of_month >= M_THRESHOLD`                                                                                                                                                                                                                                                                                 |
|                | monthly_M8_adjusted                                         | `prop_adjusted_third_of_month >= M_THRESHOLD`                                                                                                                                                                                                                                                                        |
|                | monthly_M9                                                  | `prop_first_of_month >= M_THRESHOLD`                                                                                                                                                                                                                                                                                 |
|                | monthly_M9_adjusted                                         | `prop_adjusted_first_of_month >= M_THRESHOLD`                                                                                                                                                                                                                                                                        |
|                | monthly_M10                                                 | `prop_first_bday_of_month >= M_THRESHOLD`                                                                                                                                                                                                                                                                            |
|                | monthly_M10_adjusted                                        | `prop_adjusted_first_bday_of_month >= M_THRESHOLD`                                                                                                                                                                                                                                                                   |
|                | monthly_M11                                                 | `prop_is_nth_bday_mode_beginning_of_month >= M_THRESHOLD and nth_bday_mode_beginning_of_month and nth_bday_mode_beginning_of_month >= 0`                                                                                                                                                                             |
|                | monthly_M13                                                 | `prop_is_nth_bday_mode_end_of_month >= M_THRESHOLD and nth_bday_mode_end_of_month is not None and nth_bday_mode_end_of_month <= 0`                                                                                                                                                                                   |
|                | monthly_M12                                                 | `prop_is_nth_bday_mode_middle_of_month >= M_THRESHOLD`                                                                                                                                                                                                                                                               |
|                | monthly_M1                                                  | `prop_end_month >= M_THRESHOLD`                                                                                                                                                                                                                                                                                      |
|                | monthly_M2                                                  | `prop_beginning_month >= M_THRESHOLD`                                                                                                                                                                                                                                                                                |
|                | monthly_M3                                                  | `percentage_in_paydates_monthly >= M_THRESHOLD`                                                                                                                                                                                                                                                                      |
|                | monthly_M4                                                  | `num_wom_pairs == 1`                                                                                                                                                                                                                                                                                                 |
|                | None                                                        | `cluster_time_diff_stats.std < 3 (old monthly rule)`                                                                                                                                                                                                                                                                 |
| semi-monthly   | semi-monthly_P4                                             | `mean > 12 and mean < 16 and std < 2 and number_unique_days >= 3 and (prop_is_nth_bday_mode_middle_of_month + prop_is_nth_bday_mode_end_of_month >= SM_THRESHOLD) and abs(prop_is_nth_bday_mode_middle_of_month - prop_is_nth_bday_mode_end_of_month) <= 0.40 and nth_bday_mode_end_of_month <= 0`                   |
| semi-monthly   | semi-monthly_P3                                             | `mean > 12 and mean < 16 and std < 2 and number_unique_days >= 3 and (prop_is_nth_bday_mode_beginning_of_month + prop_is_nth_bday_mode_middle_of_month >= SM_THRESHOLD) and abs(prop_is_nth_bday_mode_beginning_of_month - prop_is_nth_bday_mode_middle_of_month) <= 0.40 and nth_bday_mode_beginning_of_month >= 0` |
| semi-monthly   | semi-monthly_P1                                             | `mean > 12 and mean < 16 and std < 2 and prop_middle_or_end_month >= SM_THRESHOLD and number_unique_days >= 3`                                                                                                                                                                                                       |
| bi-weekly      | bi-weekly_B1                                                | `mean > 13 and mean < 15 and std < 1.5 and number_unique_days < 3`                                                                                                                                                                                                                                                   |
| semi-monthly   | semi-monthly_P2                                             | `mean > 12 and mean < 16 and number_unique_days >= 3 and std < 2 and percentage_in_paydates_semimonthly >= SM_THRESHOLD`                                                                                                                                                                                             |
| bi-weekly      | bi-weekly_B2                                                | `mean > 12 and mean < 16 and number_unique_days >= 3 and std < 2 and frequent_day`                                                                                                                                                                                                                                   |
|                | None                                                        | `mean > 12 and mean < 16 and std < 2 and number_unique_days >= 3`                                                                                                                                                                                                                                                    |
| PD\| weekly    | None                                                        | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and mean > 6 and mean < 8`                                                                                                                                                                                                       |
| PD\| monthly   | None                                                        | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32`                                                                                                                                                                                                 |
|                | PD\| monthly_M5                                             | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_second_wed >= M_THRESHOLD`                                                                                                                                                              |
|                | PD\| monthly_M5_adjusted                                    | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_second_wed >= M_THRESHOLD`                                                                                                                                                     |
|                | PD\| monthly_M6                                             | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_third_wed >= M_THRESHOLD`                                                                                                                                                               |
|                | PD\| monthly_M6_adjusted                                    | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_third_wed >= M_THRESHOLD`                                                                                                                                                      |
|                | PD\| monthly_M7                                             | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_fourth_wed >= M_THRESHOLD`                                                                                                                                                              |
|                | PD\| monthly_M7_adjusted                                    | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_fourth_wed >= M_THRESHOLD`                                                                                                                                                     |
|                | PD\| monthly_M8                                             | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_third_of_month >= M_THRESHOLD`                                                                                                                                                          |
|                | PD\| monthly_M8_adjusted                                    | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_third_of_month >= M_THRESHOLD`                                                                                                                                                 |
|                | PD\| monthly_M9                                             | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_first_of_month >= M_THRESHOLD`                                                                                                                                                          |
|                | PD\| monthly_M9_adjusted                                    | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_first_of_month >= M_THRESHOLD`                                                                                                                                                 |
|                | PD\| monthly_M10                                            | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_first_bday_of_month >= M_THRESHOLD`                                                                                                                                                     |
|                | PD\| monthly_M10_adjusted                                   | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_first_bda_of_month >= M_THRESHOLD`                                                                                                                                             |
|                | PD\| monthly_M1                                             | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_end_month >= M_THRESHOLD`                                                                                                                                                               |
|                | PD\| monthly_M2                                             | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_beginning_month >= M_THRESHOLD`                                                                                                                                                         |
|                | PD\| monthly_M3                                             | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and percentage_in_paydates_monthly >= M_THRESHOLD`                                                                                                                                               |
|                | PD\| monthly_M4                                             | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and num_wom_pairs == 1.00`                                                                                                                                                                       |
| PD\| bi_semi   | None                                                        | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 12 and mean < 16`                                                                                                                                                                                                 |
|                | PD\| bi_semi_P1                                             | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 12 and mean < 16 and prop_middle_or_end_month >= SM_THRESHOLD and number of unique days >= 3`                                                                                                                     |
| PD\| irregular | None                                                        | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig`                                                                                                                                                                                                                                 |

# process_none_roar_money_account

None Weekend:

To organize the conditions leading to the determination of each tagger and pattern from the `process_none_roar_money_account` method, I'll create a markdown table that lists them succinctly.

| Tagger         | Pattern                   | Condition                                                                                                                                                                                                                                        |
| -------------- | ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| weekly         | None                      | `No transactions on Saturday and Sunday; mean > 6 and < 8; std < 1`                                                                                                                                                                              |
| monthly        | monthly_M5                | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_second_wed >= M_THRESHOLD`                                                                                                                                                     |
| monthly        | monthly_M5_adjusted       | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_adjusted_second_wed >= M_THRESHOLD`                                                                                                                                            |
| monthly        | monthly_M6                | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_third_wed >= M_THRESHOLD`                                                                                                                                                      |
| monthly        | monthly_M6_adjusted       | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_adjusted_third_wed >= M_THRESHOLD`                                                                                                                                             |
| monthly        | monthly_M7                | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_fourth_wed >= M_THRESHOLD`                                                                                                                                                     |
| monthly        | monthly_M7_adjusted       | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_adjusted_fourth_wed >= M_THRESHOLD`                                                                                                                                            |
| monthly        | monthly_M8                | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_third_of_month >= M_THRESHOLD`                                                                                                                                                 |
| monthly        | monthly_M8_adjusted       | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_adjusted_third_of_month >= M_THRESHOLD`                                                                                                                                        |
| monthly        | monthly_M9                | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_first_of_month >= M_THRESHOLD`                                                                                                                                                 |
| monthly        | monthly_M9_adjusted       | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_adjusted_first_of_month >= M_THRESHOLD`                                                                                                                                        |
| monthly        | monthly_M10               | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_first_bday_of_month >= M_THRESHOLD`                                                                                                                                            |
| monthly        | monthly_M10_adjusted      | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_adjusted_first_bday_of_month >= M_THRESHOLD`                                                                                                                                   |
| monthly        | monthly_M13               | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_is_nth_bday_mode_end_of_month >= M_THRESHOLD; nth_bday_mode_end_of_month <= 0`                                                                                                 |
| monthly        | monthly_M12               | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_is_nth_bday_mode_middle_of_month >= M_THRESHOLD`                                                                                                                               |
| monthly        | monthly_M11               | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_is_nth_bday_mode_beginning_of_month >= M_THRESHOLD; nth_bday_mode_beginning_of_month >= 0`                                                                                     |
| monthly        | monthly_M1                | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_end_month >= M_THRESHOLD`                                                                                                                                                      |
| monthly        | monthly_M2                | `No transactions on Saturday and Sunday; mean > 27 and < 32; prop_beginning_month >= M_THRESHOLD`                                                                                                                                                |
| monthly        | monthly_M3                | `No transactions on Saturday and Sunday; mean > 27 and < 32; percentage_in_paydates_monthly >= M_THRESHOLD`                                                                                                                                      |
| monthly        | monthly_M4                | `No transactions on Saturday and Sunday; mean > 27 and < 32; num_wom_pairs == 1`                                                                                                                                                                 |
| semi-monthly   | semi-monthly_P4           | `No transactions on Saturday and Sunday; mean > 12 and < 16; std < 2; number_unique_days >= 3; sum of prop_is_nth_bday_mode_middle_of_month and prop_is_nth_bday_mode_end_of_month >= SM_THRESHOLD; nth_bday_mode_end_of_month <= 0`             |
| semi-monthly   | semi-monthly_P3           | `No transactions on Saturday and Sunday; mean > 12 and < 16; std < 2; number_unique_days >= 3; sum of prop_is_nth_bday_mode_beginning_of_month and prop_is_nth_bday_mode_middle_of_month >= SM_THRESHOLD; nth_bday_mode_beginning_of_month >= 0` |
| semi-monthly   | semi-monthly_P1           | `No transactions on Saturday and Sunday; mean > 12 and < 16; std < 2; prop_middle_or_end_month >= SM_THRESHOLD; number_unique_days >= 3`                                                                                                         |
| bi-weekly      | bi-weekly_B1              | `No transactions on Saturday and Sunday; mean > 13 and < 15; std < 1.5; number_unique_days < 3`                                                                                                                                                  |
| semi-monthly   | semi-monthly_P2           | `No transactions on Saturday and Sunday; mean > 12 and < 16; number_unique_days >= 3; std < 2; percentage_in_paydates_sem`                                                                                                                       |
| bi-weekly      | bi-weekly_B2              | `No transactions on Saturday and Sunday; mean > 12 and < 16; number_unique_days >= 3; std < 2; frequent_day`                                                                                                                                     |
| PD\| weekly    | None                      | `payroll_keywords_found or is_unemployment_benefit or is_treasury_benefit or is_gig and mean > 6 and mean < 8`                                                                                                                                   |
| PD\| monthly   | None                      | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32`                                                                                                                             |
|                | PD\| monthly_M5           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_second_wed >= M_THRESHOLD`                                                                                          |
|                | PD\| monthly_M5_adjusted  | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_second_wed >= M_THRESHOLD`                                                                                 |
|                | PD\| monthly_M6           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_third_wed >= M_THRESHOLD`                                                                                           |
|                | PD\| monthly_M6_adjusted  | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_third_wed >= M_THRESHOLD`                                                                                  |
|                | PD\| monthly_M7           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_fourth_wed >= M_THRESHOLD`                                                                                          |
|                | PD\| monthly_M7_adjusted  | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_fourth_wed >= M_THRESHOLD`                                                                                 |
|                | PD\| monthly_M8           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_third_of_month >= M_THRESHOLD`                                                                                      |
|                | PD\| monthly_M8_adjusted  | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_third_of_month >= M_THRESHOLD`                                                                             |
|                | PD\| monthly_M9           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_first_of_month >= M_THRESHOLD`                                                                                      |
|                | PD\| monthly_M9_adjusted  | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_first_of_month >= M_THRESHOLD`                                                                             |
|                | PD\| monthly_M10          | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_first_bday_of_month >= M_THRESHOLD`                                                                                 |
|                | PD\| monthly_M10_adjusted | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_first_bda_of_month >= M_THRESHOLD`                                                                         |
|                | PD\| monthly_M1           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_end_month >= M_THRESHOLD`                                                                                           |
|                | PD\| monthly_M2           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_beginning_month >= M_THRESHOLD`                                                                                     |
|                | PD\| monthly_M3           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and percentage_in_paydates_monthly >= M_THRESHOLD`                                                                           |
|                | PD\| monthly_M4           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and num_wom_pairs == 1.00`                                                                                                   |
| PD\| bi_semi   | None                      | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 12 and mean < 16`                                                                                                                             |
|                | PD\| bi_semi_P1           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 12 and mean < 16 and prop_middle_or_end_month >= SM_THRESHOLD and number of unique days >= 3`                                                 |
| PD\| irregular | None                      | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig`                                                                                                                                                             |
Has Weekend:

| Tagger         | Pattern                   | Condition                                                                                                                                                                                        |
| -------------- | ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| PD\| weekly    | None                      | `payroll_keywords_found or is_unemployment_benefit or is_treasury_benefit or is_gig and mean > 6 and mean < 8`                                                                                   |
| PD\| monthly   | None                      | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32`                                                                             |
|                | PD\| monthly_M5           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_second_wed >= M_THRESHOLD`                                          |
|                | PD\| monthly_M5_adjusted  | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_second_wed >= M_THRESHOLD`                                 |
|                | PD\| monthly_M6           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_third_wed >= M_THRESHOLD`                                           |
|                | PD\| monthly_M6_adjusted  | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_third_wed >= M_THRESHOLD`                                  |
|                | PD\| monthly_M7           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_fourth_wed >= M_THRESHOLD`                                          |
|                | PD\| monthly_M7_adjusted  | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_fourth_wed >= M_THRESHOLD`                                 |
|                | PD\| monthly_M8           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_third_of_month >= M_THRESHOLD`                                      |
|                | PD\| monthly_M8_adjusted  | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_third_of_month >= M_THRESHOLD`                             |
|                | PD\| monthly_M9           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_first_of_month >= M_THRESHOLD`                                      |
|                | PD\| monthly_M9_adjusted  | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_first_of_month >= M_THRESHOLD`                             |
|                | PD\| monthly_M10          | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_first_bday_of_month >= M_THRESHOLD`                                 |
|                | PD\| monthly_M10_adjusted | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_first_bda_of_month >= M_THRESHOLD`                         |
|                | PD\| monthly_M1           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_end_month >= M_THRESHOLD`                                           |
|                | PD\| monthly_M2           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_beginning_month >= M_THRESHOLD`                                     |
|                | PD\| monthly_M3           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and percentage_in_paydates_monthly >= M_THRESHOLD`                           |
|                | PD\| monthly_M4           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and num_wom_pairs == 1.00`                                                   |
| PD\| bi_semi   | None                      | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 12 and mean < 16`                                                                             |
|                | PD\| bi_semi_P1           | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 12 and mean < 16 and prop_middle_or_end_month >= SM_THRESHOLD and number of unique days >= 3` |
| PD\| irregular | None                      | `payroll_keywords_found or is_unemployment_benefit or is_treasure_benefit or is_gig`                                                                                                             |

# process_anti_payroll_keywords_present

| Tagger         | Pattern                   | Condition                                                                                                                                                                                      |
| -------------- | ------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| PD\| weekly    | None                      | `salary_keyword_found or is_unemployment_benefit or is_treasury_benefit or is_gig and mean > 6 and mean < 8`                                                                                   |
| PD\| monthly   | None                      | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32`                                                                             |
|                | PD\| monthly_M5           | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_second_wed >= M_THRESHOLD`                                          |
|                | PD\| monthly_M5_adjusted  | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_second_wed >= M_THRESHOLD`                                 |
|                | PD\| monthly_M6           | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_third_wed >= M_THRESHOLD`                                           |
|                | PD\| monthly_M6_adjusted  | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_third_wed >= M_THRESHOLD`                                  |
|                | PD\| monthly_M7           | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_fourth_wed >= M_THRESHOLD`                                          |
|                | PD\| monthly_M7_adjusted  | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_fourth_wed >= M_THRESHOLD`                                 |
|                | PD\| monthly_M8           | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_third_of_month >= M_THRESHOLD`                                      |
|                | PD\| monthly_M8_adjusted  | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_third_of_month >= M_THRESHOLD`                             |
|                | PD\| monthly_M9           | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_first_of_month >= M_THRESHOLD`                                      |
|                | PD\| monthly_M9_adjusted  | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_first_of_month >= M_THRESHOLD`                             |
|                | PD\| monthly_M10          | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_first_bday_of_month >= M_THRESHOLD`                                 |
|                | PD\| monthly_M10_adjusted | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_adjusted_first_bda_of_month >= M_THRESHOLD`                         |
|                | PD\| monthly_M1           | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_end_month >= M_THRESHOLD`                                           |
|                | PD\| monthly_M2           | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and prop_beginning_month >= M_THRESHOLD`                                     |
|                | PD\| monthly_M3           | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and percentage_in_paydates_monthly >= M_THRESHOLD`                           |
|                | PD\| monthly_M4           | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 27 and mean < 32 and num_wom_pairs == 1.00`                                                   |
| PD\| bi_semi   | None                      | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 12 and mean < 16`                                                                             |
|                | PD\| bi_semi_P1           | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig and and mean > 12 and mean < 16 and prop_middle_or_end_month >= SM_THRESHOLD and number of unique days >= 3` |
| PD\| irregular | None                      | `salary_keyword_found or is_unemployment_benefit or is_treasure_benefit or is_gig`                                                                                                             |

# ProcessClusterStats.get_exclude_stats

1. Just run the dow_checker which performs the following
   1. Sort the dataframe by transaction_date
   2. Create day date dict pair
   3. Check for semi-monthly pattern 2 - paychecks falls on 2 fixed date of a month
   4. Check for monthly pattern 3 - paycheck dates fixed date of a month
   5. Check for monthly pattern 4 - paycheck dates on a fixed day and week of a month
   6. Return the cluster stats

# ProcessClusteredTagger.process_exclude

1. Check if there are payroll keyword or is_unemployment_benefit or is_treasury_benefit or is_gig
2. If above is true then do the following
	1. If length of clustered_transactions is 2 then set as irregular or else set as single
3. Else set the tagger as np.nan
4. Run update_exclude_clustered_transactions method
5. Then return the tagged_sub_transactions_list

# process_less_2_transactions

1. Set all the transactions `is_amount_outlier` to `not_outlier`
2. Get the client_stats by calling [[Classification#ProcessClientStats.get |get]] 
3. Call the ProcessTransactionTagger.process_less_than_two() function
4. Set `clustered` as False
5. Return the transactions

# process_exception

1. Set all transactions as `not_outlier`
2. Call the [[Classification#ProcessClientStats.get |get]] function to get the client stats
3. Call ProcessTransactionTagger.process_exception function
4. Return transactions

# Functions calls table

| Name                                     | Parameters                                                                                                   | Returns                             | Number of times called | Required data/feature                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Parent                                                                                  |
| ---------------------------------------- | ------------------------------------------------------------------------------------------------------------ | ----------------------------------- | ---------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| manipulate_date_columns                  | transactions -> df                                                                                           | transactions -> df                  | 1                      | transaction_dates                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | classification                                                                          |
| process_cluster                          | group -> df<br><br>bv_account_id -> str<br><br>client_id -> str<br><br>unique_cluster_id -> str              | transactions -> df                  | 1                      | unique_cluster_id -> in this case is `income_id`<br><br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | classification                                                                          |
| process_cluster_include                  | transactions_include -> df<br><br>unique_cluster_id -> str<br>                                               | transactions -> df                  | 1                      | unique_cluster_id -> in this case is `income_id`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | [[Classification#process_cluster]]                                                      |
| identify_include (IdentifyAmountOutlier) | clustured_transactions -> df<br><br>compressed_clustered_transaction -> df                                   | transactions -> df                  | 1                      | amount -> int                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | [[Classification#process_cluster_include]]                                              |
| compress_transaction_to_same_day_amount  | df_ori -> df<br><br>unique_cluster_id -> str                                                                 | transactions -> df                  | 1                      | transaction_dates                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | [[Classification#identify_include]]                                                     |
| calculate_cluster_time_diff_stats        | df -> df<br><br>drop_na -> bool                                                                              | transactions -> df                  | 2                      | date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | [[Classification#identify_include]], [[Classification#ProcessClusterTimDiffStats.get ]] |
| rectify_false_amount_outlier             | df -> df                                                                                                     | transactions -> df                  | 1                      | is_amount_outlier -> bool<br><br>time_diff -> int                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | [[Classification#identify_include]]                                                     |
| get (ProcessClientStats)                 | clustured_transactions -> df                                                                                 | client_stats                        | 1                      | istreasurybenefit -> int<br><br>isunemploymentbenefit -> int<br><br>isgig -> int<br><br>account_type -> str                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | [[Classification#process_cluster_include]]                                              |
| get_include_stats (ProcessClusterStats)  | clustered_transactions -> df                                                                                 | cluster_stats                       | 1                      | Refer code as there are a lot                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | [[Classification#process_cluster_include]]                                              |
| get (ProcessClusterTimeDiffStats)        | unique_cluster_id -> str<br><br>clustered_transactions_wo_outlier -> df                                      | cluster_time_diff_stats             | 1                      | date<br><br>time_diff<br><br>day                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | [[Classification#process_cluster_include]]                                              |
| process_include (ProcessClusteredTagger) | word_list -> list                                                                                            | clustered_transactions -> df        | 1                      | transaction_dates<br><br>description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | [[Classification#process_cluster_include]]                                              |
| is_anti_payroll_keywords_found           | word_list -> list                                                                                            | anti_payroll_keywords_found -> bool | 1                      | description/feed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | [[Classification#ProcessClusteredTagger.process_include]]                               |
| get_most_frequent_feed                   | word_list -> list                                                                                            | most_common_word -> str             | 1                      | description/feed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | [[Classification#is_anti_payroll_keywords_found]]                                       |
| is_keyword_present_in_feed               | most_common_word -> str<br><br>ANTI_PAYROLL_KEYWORDS -> list                                                 | bool                                | 1                      | description/feed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | [[Classification#is_anti_payroll_keywords_found]]                                       |
| get_payroll_keywords_found               | word_list -> list                                                                                            | payroll_keywords -> list            | 1                      | description/feed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | [[Classification#ProcessClusteredTagger.process_include]]                               |
| process_roar_money_account               | payroll_keywords_found -> list <br>                                                                          | clustered_transactions -> df        | 1                      | - `cluster_time_diff_stats.mean`<br>- `cluster_time_diff_stats.std`<br>- `cluster_time_diff_stats.get_number_unique_days()`<br>- `payroll_keywords_found`<br>- `client_stats.is_unemployment_benefit`<br>- `client_stats.is_treasury_benefit`<br>- `client_stats.is_gig`<br>- `cluster_stats.prop_second_wed`<br>- `cluster_stats.prop_adjusted_second_wed`<br>- `cluster_stats.prop_third_wed`<br>- `cluster_stats.prop_adjusted_third_wed`<br>- `cluster_stats.prop_fourth_wed`<br>- `cluster_stats.prop_adjusted_fourth_wed`<br>- `cluster_stats.prop_third_of_month`<br>- `cluster_stats.prop_adjusted_third_of_month`<br>- `cluster_stats.prop_first_of_month`<br>- `cluster_stats.prop_adjusted_first_of_month`<br>- `cluster_stats.prop_first_bday_of_month`<br>- `cluster_stats.prop_adjusted_first_bday_of_month`<br>- `cluster_stats.prop_end_month`<br>- `cluster_stats.prop_beginning_month`<br>- `cluster_stats.percentage_in_paydates_monthly`<br>- `cluster_stats.num_wom_pairs`<br>- `cluster_stats.nth_bday_mode_end_of_month`<br>- `cluster_stats.nth_bday_mode_beginning_of_month`<br>- `cluster_stats.prop_is_nth_bday_mode_end_of_month`<br>- `cluster_stats.prop_is_nth_bday_mode_middle_of_month`<br>-`cluster_stats.prop_is_nth_bday_mode_beginning_of_month`<br>- `cluster_stats.prop_middle_or_end_month`<br>- `cluster_stats.percentage_in_paydates_semimonthly`<br>- `cluster_time_diff_stats.frequent_day`<br>- `M_THRESHOLD`<br>- `SM_THRESHOLD`                                                                                                                                               | [[Classification#ProcessClusteredTagger.process_include]]                               |
| process_none_roar_money_account          | payroll_keywords_found -> list                                                                               | clustered_transactions -> df        | 1                      | - `self.cluster_time_diff_stats.get_days_list()`<br>- `self.cluster_time_diff_stats.mean`<br>- `self.cluster_time_diff_stats.std`<br>- `self.cluster_stats.prop_second_wed`<br>- `self.cluster_stats.prop_adjusted_second_wed`<br>- `self.cluster_stats.prop_third_wed`<br>- `self.cluster_stats.prop_adjusted_third_wed`<br>- `self.cluster_stats.prop_fourth_wed`<br>- `self.cluster_stats.prop_adjusted_fourth_wed`<br>- `self.cluster_stats.prop_third_of_month`<br>- `self.cluster_stats.prop_adjusted_third_of_month`<br>- `self.cluster_stats.prop_first_of_month`<br>- `self.cluster_stats.prop_adjusted_first_of_month`<br>- `self.cluster_stats.prop_first_bday_of_month`<br>- `self.cluster_stats.prop_adjusted_first_bday_of_month`<br>- `self.cluster_stats.prop_is_nth_bday_mode_end_of_month`<br>- `self.cluster_stats.nth_bday_mode_end_of_month`<br>- `self.cluster_stats.prop_is_nth_bday_mode_middle_of_month`<br>- `self.cluster_stats.prop_is_nth_bday_mode_beginning_of_month`<br>- `self.cluster_stats.nth_bday_mode_beginning_of_month`<br>- `self.cluster_stats.prop_end_month`<br>- `self.cluster_stats.prop_beginning_month`<br>- `self.cluster_stats.percentage_in_paydates_monthly`<br>- `self.cluster_stats.num_wom_pairs`<br>- `self.cluster_stats.prop_middle_or_end_month`<br>- `self.cluster_time_diff_stats.get_number_unique_days()`<br>- `self.cluster_time_diff_stats.frequent_day`<br>- `payroll_keywords_found`<br>- `self.client_stats.is_unemployment_benefit`<br>- `self.client_stats.is_treasury_benefit`<br>- `self.client_stats.is_gig`<br>- `M_THRESHOLD`<br>- `SM_THRESHOLD` | [[Classification#ProcessClusteredTagger.process_include]]                               |
| process_anti_payroll_keywords_present    | salary_keywords -> list                                                                                      | clustered_transactions -> df        | 1                      | - `salary_keywords_found`<br>- `self.client_stats.is_unemployment_benefit`<br>- `self.client_stats.is_treasury_benefit`<br>- `self.client_stats.is_gig`<br>- `self.cluster_time_diff_stats.mean`<br>- `self.cluster_time_diff_stats.std`<br>- `self.cluster_stats.prop_second_wed`<br>- `self.cluster_stats.prop_adjusted_second_wed`<br>- `self.cluster_stats.prop_third_wed`<br>- `self.cluster_stats.prop_adjusted_third_wed`<br>- `self.cluster_stats.prop_fourth_wed`<br>- `self.cluster_stats.prop_adjusted_fourth_wed`<br>- `self.cluster_stats.prop_third_of_month`<br>- `self.cluster_stats.prop_adjusted_third_of_month`<br>- `self.cluster_stats.prop_first_of_month`<br>- `self.cluster_stats.prop_adjusted_first_of_month`<br>- `self.cluster_stats.prop_first_bday_of_month`<br>- `self.cluster_stats.prop_adjusted_first_bday_of_month`<br>- `self.cluster_stats.prop_end_month`<br>- `self.cluster_stats.prop_beginning_month`<br>- `self.cluster_stats.percentage_in_paydates_monthly`<br>- `self.cluster_stats.num_wom_pairs`<br>- `self.cluster_stats.prop_middle_or_end_month`<br>- `self.cluster_time_diff_stats.get_number_unique_days()`<br>- `M_THRESHOLD`<br>- `SM_THRESHOLD`                                                                                                                                                                                                                                                                                                                                                                                                                       | [[Classification#ProcessClusteredTagger.process_include]]                               |
| process_cluster_exclude                  | transaction_exclude -> df<br><br>unique_cluster_id -> str                                                    | transactions -> df                  | 1                      | - `transaction_dates`<br>- `unique_cluster_id`<br>- `istreasurebenefit`<br>- `isunemploymentbenefit`<br>- `isgig`<br>- `account_type`<br>- `day_of_month`<br>- `dow`<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | [[Classification#process_cluster]]                                                      |
| get_exclude_stats                        | clustered_transactions -> df                                                                                 | transactions -> df                  | 1                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | [[Classification#process_cluster_exclude]]                                              |
| process_exclude                          | clustered_transactions -> df<br><br>client_stats<br><br>cluster_stats<br><br>cluster_time_diff_stats -> None | transactions -> df                  | 1                      | word_list -> list<br><br>client_stats<br><br>cluster_stats                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | [[Classification#process_cluster_exclude]]                                              |
| process_less_2_transactions              | transactions -> df                                                                                           | transactions -> df                  | 1                      | client_stats                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | [[Classification#process_cluster]]                                                      |
| process_exception                        | transactions -> df                                                                                           | transactions -> df                  | 1                      | client_stats                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | [[Classification#process_cluster]]                                                      |
|                                          |                                                                                                              |                                     |                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                         |
